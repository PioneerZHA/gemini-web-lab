<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D äº¤äº’å¡ç‰Œ - ç»ˆæä¿®å¤ç‰ˆ</title>
    <style>
        :root {
            --card-width: 300px;
            --card-height: 420px;
            --card-radius: 16px;
            --accent-color: #00ffcc;
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #111;
            background-image: radial-gradient(circle at 50% 50%, #2a2a2a 0%, #000 100%);
            font-family: sans-serif;
            overflow: hidden;
        }

        /* æ§åˆ¶é¢æ¿ */
        .controls {
            margin-bottom: 40px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            width: 90%;
            max-width: 400px;
        }
        
        .input-group { display: flex; gap: 10px; }
        
        input[type="text"] {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #444;
            color: #fff;
            padding: 8px;
            border-radius: 4px;
        }
        
        button, .file-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            transition: 0.2s;
        }
        
        button:hover, .file-btn:hover {
            background: var(--accent-color);
            color: #000;
        }
        
        input[type="file"] { display: none; }

        /* --- æ ¸å¿ƒç»“æ„ --- */

        /* 1. èˆå°å±‚ï¼šè´Ÿè´£é€è§†å’Œé¼ æ ‡ç›‘å¬ï¼Œæœ¬èº«ä¸æ—‹è½¬ */
        .scene {
            width: var(--card-width);
            height: var(--card-height);
            position: relative;
            perspective: 1200px; /* 3D è§†è· */
            z-index: 10;
            /* å°ºå¯¸å˜åŒ–æ—¶çš„å¹³æ»‘è¿‡æ¸¡ */
            transition: width 0.5s ease, height 0.5s ease; 
        }

        /* 2. å¡ç‰‡å±‚ï¼šè´Ÿè´£æ—‹è½¬ */
        .card {
            width: 100%;
            height: 100%;
            position: absolute;
            border-radius: var(--card-radius);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-image: url('https://images.unsplash.com/photo-1635322966219-b75ed372eb01?q=80&w=1000&auto=format&fit=crop');
            background-color: #000;
            
            /* å…³é”®ï¼šä¿ç•™3Dç©ºé—´ */
            transform-style: preserve-3d;
            will-change: transform;
            
            /* é˜´å½± */
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* çº¹ç†è¾¹æ¡† */
        .card::after {
            content: "";
            position: absolute;
            inset: 0;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: var(--card-radius);
        }

        /* 3. å…‰æ•ˆå±‚ */
        .card-glare, .card-shine {
            position: absolute;
            inset: 0;
            border-radius: var(--card-radius);
            pointer-events: none; /* å¿…é¡»ç©¿é€ï¼Œå¦åˆ™æŒ¡ä½é¼ æ ‡ */
            opacity: 0;
            transition: opacity 0.3s;
        }

        /* é«˜å…‰ */
        .card-glare {
            background: radial-gradient(
                farthest-corner circle at var(--pointer-x) var(--pointer-y),
                rgba(255, 255, 255, 0.8) 0%,
                rgba(255, 255, 255, 0.1) 40%,
                transparent 80%
            );
            mix-blend-mode: overlay;
        }

        /* é•­å°„ */
        .card-shine {
            background: linear-gradient(
                115deg,
                transparent 20%,
                rgba(0, 255, 204, 0.5) 45%,
                rgba(255, 0, 204, 0.5) 55%,
                transparent 80%
            );
            background-size: 300% 300%;
            background-position: var(--bg-x) var(--bg-y);
            mix-blend-mode: color-dodge;
        }
        
        .hint {
            position: absolute;
            bottom: -30px;
            color: #666;
            width: 100%;
            text-align: center;
            font-size: 12px;
        }

    </style>
</head>
<body>

    <div class="controls">
        <label for="fileIn" class="file-btn">ğŸ“‚ ä¸Šä¼ å›¾ç‰‡</label>
        <input type="file" id="fileIn" accept="image/*">
        
        <div class="input-group">
            <input type="text" id="urlIn" placeholder="è¾“å…¥å›¾ç‰‡é“¾æ¥...">
            <button id="loadBtn">åŠ è½½</button>
        </div>
    </div>

    <!-- å…³é”®ç»“æ„ï¼šScene åŒ…è£¹ Card -->
    <div class="scene" id="scene">
        <div class="card" id="card">
            <div class="card-shine"></div>
            <div class="card-glare"></div>
        </div>
        <div class="hint">æ­£åœ¨è¯»å–å›¾ç‰‡å°ºå¯¸...</div>
    </div>

    <script>
    const scene = document.getElementById('scene');
    const card = document.getElementById('card');
    const glare = document.querySelector('.card-glare');
    const shine = document.querySelector('.card-shine');
    const hint = document.querySelector('.hint');

    // --- æ ¸å¿ƒé€»è¾‘å°è£…ï¼šé€šç”¨å¤„ç†å‡½æ•° ---
    
    // 1. å¤„ç†ç§»åŠ¨ (æ— è®ºæ˜¯é¼ æ ‡è¿˜æ˜¯æ‰‹æŒ‡)
    function handleMove(clientX, clientY) {
        // å¿…é¡»ç¬é—´å“åº”ï¼Œå…³é—­è¿‡æ¸¡
        card.style.transition = 'none';

        const rect = scene.getBoundingClientRect();
        // è®¡ç®—ç›¸å¯¹åæ ‡
        const x = clientX - rect.left;
        const y = clientY - rect.top;
        
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        
        // æ—‹è½¬è®¡ç®— (ç§»åŠ¨ç«¯å¯ä»¥ç¨å¾®åŠ å¤§ä¸€ç‚¹çµæ•åº¦)
        const rotateX = ((y - centerY) / centerY) * -18; // ç¨å¾®åŠ å¤§è§’åº¦
        const rotateY = ((x - centerX) / centerX) * 18;

        // åº”ç”¨å˜æ¢
        card.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.05, 1.05, 1.05)`;

        // å…‰æ•ˆè®¡ç®—
        card.style.setProperty('--pointer-x', `${x}px`);
        card.style.setProperty('--pointer-y', `${y}px`);
        
        const bgX = 50 + ((x / rect.width) * 50);
        const bgY = 50 + ((y / rect.height) * 50);
        card.style.setProperty('--bg-x', `${bgX}%`);
        card.style.setProperty('--bg-y', `${bgY}%`);

        // æ˜¾ç¤ºå…‰æ•ˆ
        glare.style.opacity = '1';
        shine.style.opacity = '1';
    }

    // 2. å¤„ç†ç¦»å¼€/ç»“æŸ (å¤ä½)
    function handleReset() {
        // å¼€å¯å¹³æ»‘è¿‡æ¸¡ï¼Œäº§ç”Ÿå›å¼¹æ•ˆæœ
        card.style.transition = 'transform 0.6s cubic-bezier(0.23, 1, 0.32, 1)';
        
        card.style.transform = `rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)`;
        glare.style.opacity = '0';
        shine.style.opacity = '0';
    }

    // --- äº‹ä»¶ç›‘å¬ï¼šPCç«¯ (é¼ æ ‡) ---

    scene.addEventListener('mousemove', (e) => {
        handleMove(e.clientX, e.clientY);
    });

    scene.addEventListener('mouseleave', handleReset);

    // --- äº‹ä»¶ç›‘å¬ï¼šç§»åŠ¨ç«¯ (è§¦æ‘¸) ---

    // è§¦æ‘¸å¼€å§‹ï¼šä¸ºäº†é˜²æ­¢é—ªçƒï¼Œå¼€å§‹æ—¶ä¹Ÿå…³é—­åŠ¨ç”»
    scene.addEventListener('touchstart', (e) => {
        card.style.transition = 'none';
        // å¦‚æœæƒ³ä¸€æŒ‰ä¸‹å»å°±åŠ¨ï¼Œå¯ä»¥è¿™é‡Œä¹Ÿè°ƒç”¨ handleMove
        handleMove(e.touches[0].clientX, e.touches[0].clientY);
    }, { passive: false });

    // è§¦æ‘¸ç§»åŠ¨ï¼šå…³é”®é€»è¾‘
    scene.addEventListener('touchmove', (e) => {
        // âš ï¸ å…³é”®ï¼šé˜»æ­¢é»˜è®¤çš„é¡µé¢æ»šåŠ¨è¡Œä¸º
        // å¦åˆ™æ‰‹æŒ‡åŠ¨çš„æ—¶å€™ï¼Œæ˜¯é¡µé¢åœ¨æ»šåŠ¨ï¼Œè€Œä¸æ˜¯å¡ç‰‡åœ¨åŠ¨
        e.preventDefault(); 
        
        const touch = e.touches[0];
        handleMove(touch.clientX, touch.clientY);
    }, { passive: false }); // passive: false æ˜¯ä¸ºäº†å…è®¸ preventDefault ç”Ÿæ•ˆ

    // è§¦æ‘¸ç»“æŸï¼šå¤ä½
    scene.addEventListener('touchend', handleReset);
    scene.addEventListener('touchcancel', handleReset);


    // --- å›¾ç‰‡åŠ è½½é€»è¾‘ (ä¿æŒä¸å˜) ---
    
    const fileIn = document.getElementById('fileIn');
    const urlIn = document.getElementById('urlIn');
    const loadBtn = document.getElementById('loadBtn');

    function updateImage(src) {
        hint.style.opacity = '1';
        hint.textContent = "åŠ è½½ä¸­...";
        
        const img = new Image();
        img.onload = () => {
            const ratio = img.naturalWidth / img.naturalHeight;
            
            // ç§»åŠ¨ç«¯é€‚é…ï¼šé˜²æ­¢å¡ç‰‡æ¯”å±å¹•è¿˜å®½
            const screenW = window.innerWidth;
            let maxWidth = screenW * 0.85; // ç•™å‡ºä¸€ç‚¹è¾¹è·
            
            let h = 500;
            let w = h * ratio;
            
            // å¦‚æœè®¡ç®—å‡ºçš„å®½åº¦è¶…è¿‡å±å¹•å®½åº¦çš„85%ï¼Œå¼ºè¡Œç¼©å°
            if(w > maxWidth) {
                w = maxWidth;
                h = w / ratio;
            }

            document.documentElement.style.setProperty('--card-width', `${w}px`);
            document.documentElement.style.setProperty('--card-height', `${h}px`);
            
            card.style.backgroundImage = `url('${src}')`;
            hint.style.opacity = '0';
        };
        img.onerror = () => {
            hint.textContent = "åŠ è½½å¤±è´¥";
        };
        img.src = src;
    }

    fileIn.addEventListener('change', (e) => {
        if(e.target.files[0]) {
            const reader = new FileReader();
            reader.onload = (ev) => updateImage(ev.target.result);
            reader.readAsDataURL(e.target.files[0]);
        }
    });

    loadBtn.addEventListener('click', () => {
        if(urlIn.value) updateImage(urlIn.value);
    });

    hint.style.opacity = '0';
    </script>
</body>
</html>